<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edPrg">
	<select id="edPrg.selectEdPrmList" parameterType="hashMap" resultType="egovframework.rte.psl.dataaccess.util.EgovMap">
		/* edPrg.selectEdPrmList */
		SELECT @RNUM := @RNUM + 1 AS ROWNUM
			 , PGM_ID
			 , PGM_ED_CD
			 , (SELECT Z.CD_NM FROM SYS_CD Z WHERE Z.CD_ID =PGM_ED_CD) AS PGM_ED_NM
			 , PGM_CLASS_NM_CD
			 , (SELECT Z.CD_NM FROM SYS_CD Z WHERE Z.CD_ID =PGM_CLASS_NM_CD) AS PGM_CLASS_NM
			 , PGM_CLASS_SUB_CD
			 , (SELECT Z.CD_NM FROM SYS_CD Z WHERE Z.CD_ID =PGM_CLASS_SUB_CD) AS PGM_CLASS_SUB_NM
			 , (SELECT COUNT(Z.PGM_MBR_ID)  FROM ED_PGM_MBR Z WHERE Z.PGM_ID = EP.PGM_ID) AS PGM_MBR_COUNT
			 , PGM_MAIN_LEC
			 , PGM_SUB_LEC
			 , PGM_START_DT
			 , PGM_END_DT
			 , PGM_START_TM
			 , PGM_END_TM
			 , PGM_DUR
			 , PGM_SESSION
			 , PGM_CLASS
			 , PGM_AGENT
			 , PGM_MNG_USR_ID
			 , PGM_CLASS_START_DT
			 , PGM_CLASS_END_DT
			 , PGM_CLASS_START_TM
			 , PGM_CLASS_END_TM
			 , PGM_CLASS_DUR
			 , PGM_SUBJECT
			 , PGM_GOAL
			 , PGM_CTNT
			 , PGM_RST
			 , FILE_ID
			 , PGM_EMP
			 , PGM_VOL
			 , CRE_ID
			 , CRE_DT
			 , UPD_ID
			 , UPD_DT 
		  FROM ED_PGM EP, (SELECT @RNUM := 0) RNUM
		 WHERE 1 = 1
		 <if test="schStrDt != null and schStrDt != '' ">
		   AND PGM_START_DT <![CDATA[>=]]> #{schStrDt} 
		 </if>
		 <if test="schEndDt != null and schEndDt != ''">
		   AND PGM_END_DT  <![CDATA[<=]]> #{schEndDt}
		 </if>
		 <if test="pgmEdCdList != null and pgmEdCdList.size != 0">
		   AND PGM_ED_CD IN
		   	<foreach collection="pgmEdCdList" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
		   	</foreach> 
		 </if>
		 <if test="pgmClassNmList != null and pgmClassNmList.size != 0">
		   AND PGM_CLASS_NM_CD IN
		   	<foreach collection="pgmClassNmList" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
		   	</foreach> 
		 </if>
		 <if test="pgmClassSubList != null and pgmClassSubList.size != 0">
		   AND PGM_CLASS_SUB_CD IN
		   	<foreach collection="pgmClassSubList" item="item" index="index" separator="," open="(" close=")">
		   		#{item}
		   	</foreach> 
		 </if>
	
	</select>

	<select id="edPrg.selectEdPrmInfo" parameterType="hashMap" resultType="egovframework.rte.psl.dataaccess.util.EgovMap">
		/* edPrg.selectEdPrmInfo */
	<![CDATA[
		SELECT PGM_ID
			 , PGM_ED_CD
			 , PGM_CLASS_NM_CD
			 , PGM_CLASS_SUB_CD
			 , PGM_MAIN_LEC
			 , PGM_SUB_LEC
			 , PGM_START_DT
			 , PGM_END_DT
			 , PGM_START_TM
			 , PGM_END_TM
			 , PGM_DUR
			 , PGM_SESSION
			 , PGM_CLASS
			 , PGM_AGENT
			 , PGM_MNG_USR_ID
			 , PGM_CLASS_START_DT
			 , PGM_CLASS_START_TM
			 , PGM_CLASS_END_DT
			 , PGM_CLASS_END_TM
			 , PGM_CLASS_DUR
			 , PGM_SUBJECT
			 , PGM_GOAL
			 , PGM_CTNT
			 , PGM_RST
			 , FILE_ID
			 , PGM_EMP
			 , PGM_VOL
			 , CRE_ID
			 , CRE_DT
			 , UPD_ID
			 , UPD_DT
		  FROM ED_PGM
		 WHERE PGM_ID = #{pgmId}
	]]>
	</select>

	<select id="edPrg.selectEdPrmInfoMap" parameterType="hashMap" resultType="hashMap">
		/* edPrg.selectEdPrmInfoMap */
	<![CDATA[
		SELECT PGM_ID
			 , PGM_ED_CD
			 , PGM_CLASS_NM_CD
			 , PGM_CLASS_SUB_CD
			 , PGM_MAIN_LEC
			 , PGM_SUB_LEC
			 , PGM_START_DT
			 , PGM_END_DT
			 , PGM_START_TM
			 , PGM_END_TM
			 , PGM_DUR
			 , PGM_SESSION
			 , PGM_CLASS
			 , PGM_AGENT
			 , PGM_MNG_USR_ID
			 , PGM_CLASS_START_DT
			 , PGM_CLASS_START_TM
			 , PGM_CLASS_END_DT
			 , PGM_CLASS_END_TM
			 , PGM_CLASS_DUR
			 , PGM_SUBJECT
			 , PGM_GOAL
			 , PGM_CTNT
			 , PGM_RST
			 , EP.FILE_ID
			 , PGM_EMP
			 , PGM_VOL
			 , EP.CRE_ID
			 , EP.CRE_DT
			 , EP.UPD_ID
			 , EP.UPD_DT
			 , FI.ORIGNL_FILE_NM
		  	 , SC01.CD_NM AS PGM_ED_NM							, SC02.CD_NM AS PGM_CLASS_NM_NM
			 , SC03.CD_NM AS PGM_CLASS_SUB_NM				, SC04.CD_NM AS CSL_SITE_NM
		  FROM ED_PGM EP
		    LEFT JOIN FILE_INFO FI ON (FI.FILE_ID = EP.FILE_ID)
			LEFT JOIN SYS_CD SC01 ON (SC01.GRP_CD = 'R0100' AND SC01.CD_ID = EP.PGM_ED_CD)
			LEFT JOIN SYS_CD SC02 ON (SC02.GRP_CD = 'R0101' AND SC02.CD_ID = EP.PGM_CLASS_NM_CD)
			LEFT JOIN SYS_CD SC03 ON (SC03.GRP_CD = 'R010101' AND SC03.CD_ID = EP.PGM_CLASS_SUB_CD)
			LEFT JOIN SYS_CD SC04 ON (SC04.GRP_CD = 'C1200' AND SC04.CD_ID = EP.PGM_CLASS_NM_CD)
		 WHERE PGM_ID = #{pgmId} 
	]]>
	</select>

	<insert id="edPrg.insertEdPrmInfo" parameterType="hashMap">
		/* edPrg.insertEdPrmInfo */
	<![CDATA[
		INSERT INTO ED_PGM (
				  PGM_ED_CD		, PGM_CLASS_NM_CD	, PGM_CLASS_SUB_CD	, PGM_MAIN_LEC	, PGM_SUB_LEC			
				, PGM_START_DT	, PGM_START_TM		, PGM_END_DT		, PGM_END_TM	, PGM_DUR
				, PGM_SESSION	, PGM_CLASS			, PGM_AGENT
				, PGM_MNG_USR_ID, PGM_CLASS_START_DT, PGM_CLASS_START_TM, PGM_CLASS_END_DT, PGM_CLASS_END_TM	
				, PGM_CLASS_DUR
				, PGM_SUBJECT	, PGM_GOAL			, PGM_CTNT			, PGM_RST				, FILE_ID
				, PGM_EMP		, PGM_VOL			, CRE_ID			, CRE_DT				, UPD_ID
				, UPD_DT 
		) VALUES (
				  #{pgmEdCd}	, #{pgmClassNmCd}	, #{pgmClassSubCd}	, #{pgmMainLec}		, #{pgmSubLec}		
				, #{pgmStartDt} , #{pgmStartTm}		, #{pgmEndDt}		, #{pgmEndTm}		, #{pgmDur}
				, #{pgmSession}	, #{pgmClass}		, #{pgmAgent}
				, #{pgmMngUsrId}, #{pgmClassStartDt}, #{pgmClassStartTm}, #{pgmClassEndDt}	, #{pgmClassEndTm}	
				, #{pgmClassDur}
				, #{pgmSubject}	, #{pgmGoal}		, #{pgmCtnt}		, #{pgmRst}			, #{fileId}
				, #{pgmEmp}		, #{pgmVol}			, #{creId}			, NOW()			, #{updId}
				, #{updDt}
		)
				
	]]>
	</insert>

	<update id="edPrg.updateEdPrmInfo" parameterType="hashMap">
		/* edPrg.updateEdPrmInfo */ 
	<![CDATA[
		UPDATE ED_PGM
		   SET PGM_ED_CD  			= #{pgmEdCd}			, PGM_CLASS_NM_CD 	= #{pgmClassNmCd}	
		   	 , PGM_CLASS_SUB_CD		= #{pgmClassSubCd}
		     , PGM_MAIN_LEC			= #{pgmMainLec}			, PGM_SUB_LEC 	  	= #{pgmSubLec}
		     , PGM_START_DT  		= #{pgmStartDt}			, PGM_START_TM		= #{pgmStartTm}
		     , PGM_END_DT			= #{pgmEndDt}			, PGM_END_TM		= #{pgmEndTm}
			 , PGM_DUR  			= #{pgmDur}				, PGM_SESSION		= #{pgmSession}
			 , PGM_CLASS  			= #{pgmClass}			, PGM_AGENT			= #{pgmAgent}
			 , PGM_MNG_USR_ID  		= #{pgmMngUsrId}		
			 , PGM_CLASS_START_DT	= #{pgmClassStartDt}	, PGM_CLASS_END_DT	= #{pgmClassEndDt}
			 , PGM_CLASS_START_TM  	= #{pgmClassStartTm}	, PGM_CLASS_END_TM	= #{pgmClassEndTm}	
			 , PGM_CLASS_DUR  		= #{pgmClassDur}		, PGM_SUBJECT		= #{pgmSubject}
			 , PGM_GOAL  			= #{pgmGoal}			, PGM_CTNT			= #{pgmCtnt}
			 , PGM_RST	  			= #{pgmRst}				, FILE_ID			= #{fileId}
			 , PGM_EMP  			= #{pgmEmp}				, PGM_VOL			= #{pgmVol}
			 , UPD_ID	  			= #{updId}				, UPD_DT 			= NOW()
		 WHERE PGM_ID = #{pgmId}
	]]>
	</update>

	<select id="edPrg.selectEdPrmListCount" parameterType="hashMap" resultType="egovframework.rte.psl.dataaccess.util.EgovMap">
		/* edPrg.selectEdPrmListCount */
	<![CDATA[
		SELECT  COUNT(*) AS CNT
		  FROM ED_PGM
	]]>
	</select>
	
	<delete id="edPrg.deleteEdPrm" parameterType="hashMap">
		/* edPrg.deleteEdPrm */
		DELETE FROM ED_PGM WHERE PGM_ID = #{pgmId}
	</delete>
	
	<delete id="edPrg.deleteEdPrmMbr" parameterType="hashMap">
		/* edPrg.deleteEdPrmMbr */
		DELETE FROM ED_PGM_MBR WHERE PGM_ID = #{pgmId}
	</delete>
</mapper>